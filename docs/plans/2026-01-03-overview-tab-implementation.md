# Overview Tab Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Implement a tabbed tournament view with a personalized Overview tab showing user's match, stats, possible opponents, and match history.

**Architecture:** Rename `BracketView` â†’ `TournamentView`, add shadcn Tabs with URL sync (`?tab=overview`), create Overview tab components that compose existing `MatchSummaryCard` and `YourMatchesSection`. Mobile-first responsive grid layout.

**Tech Stack:** React 18, TypeScript, shadcn/ui Tabs, Tailwind CSS, React Router `useSearchParams`

---

## Prerequisites

Before starting, ensure you understand:

- **Existing implementation plan:** `docs/plans/tournament-view/2026-01-03-overview-tab-implementation.md` (design decisions)
- **Design spec:** `docs/plans/tournament-view/2026-01-03-scalable-cup-view-design.md` (full spec)
- **Current component:** `src/components/tournament/BracketView.tsx` (428 lines, will be renamed)
- **Reusable components:** `MatchSummaryCard`, `YourMatchesSection`, `buildMatchesForTeam()`

---

## Task 1: Add shadcn Tabs Component

**Files:**
- Create: `src/components/ui/tabs.tsx` (generated by shadcn)

**Step 1: Install shadcn Tabs**

Run: `npx shadcn@latest add tabs`

Expected output:
```
âœ” Done.
Created 1 file:
  - src/components/ui/tabs.tsx
```

**Step 2: Verify installation**

Run: `ls src/components/ui/tabs.tsx`
Expected: File exists

**Step 3: Commit**

```bash
git add src/components/ui/tabs.tsx
git commit -m "$(cat <<'EOF'
feat: add shadcn tabs component

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"
```

---

## Task 2: Add `qualifiesTo` Field to Match Type

**Files:**
- Modify: `src/types/tournament.ts:20-30`

**Step 1: Update Match interface**

Add the `qualifiesTo` field after `isBye`:

```typescript
export interface Match {
  id: string;
  // New: array of players for N-way matches (optional for backward compatibility)
  players?: MatchPlayer[];
  // Legacy: kept for backward compatibility with 1v1 matches
  player1?: MatchPlayer | null;
  player2?: MatchPlayer | null;
  winnerId: number | null; // FPL team ID
  isBye: boolean;
  qualifiesTo?: string; // ID of the match this winner advances to (null in final)
  updatedAt?: string; // ISO timestamp of last score update
}
```

**Step 2: Verify TypeScript compiles**

Run: `npx tsc --noEmit`
Expected: No errors (the field is optional so no updates needed elsewhere)

**Step 3: Commit**

```bash
git add src/types/tournament.ts
git commit -m "$(cat <<'EOF'
feat: add qualifiesTo field to Match type

Enables finding sibling matches for the Possible Opponents feature.
The field is optional and links a match to its next-round target.

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"
```

---

## Task 3: Create TournamentView Shell (Rename BracketView)

**Files:**
- Rename: `src/components/tournament/BracketView.tsx` â†’ `src/components/tournament/TournamentView.tsx`
- Modify: `src/pages/LeaguePage.tsx` (update import)

**Step 1: Rename the file**

Run: `git mv src/components/tournament/BracketView.tsx src/components/tournament/TournamentView.tsx`

**Step 2: Update the component name inside TournamentView.tsx**

Find and replace:
- `function BracketView(` â†’ `function TournamentView(`
- `interface BracketViewProps` â†’ `interface TournamentViewProps`
- `export function BracketView` â†’ `export function TournamentView`

**Step 3: Update LeaguePage.tsx import**

```typescript
// Change this:
import { BracketView } from '../components/tournament/BracketView';
// To this:
import { TournamentView } from '../components/tournament/TournamentView';
```

And update the JSX:
```tsx
// Change this:
<BracketView
// To this:
<TournamentView
```

**Step 4: Verify application builds**

Run: `npm run build`
Expected: Build succeeds

**Step 5: Commit**

```bash
git add -A
git commit -m "$(cat <<'EOF'
refactor: rename BracketView to TournamentView

Prepares for tab-based tournament view architecture.
No functional changes.

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"
```

---

## Task 4: Add Tabs Wrapper to TournamentView

**Files:**
- Modify: `src/components/tournament/TournamentView.tsx`

**Step 1: Add imports for Tabs and useSearchParams**

At the top of the file, add:

```typescript
import { useSearchParams } from 'react-router-dom';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../ui/tabs';
```

**Step 2: Add tab state management using URL**

Inside the `TournamentView` function, after existing state declarations, add:

```typescript
// Tab state from URL (defaults to 'overview')
const [searchParams, setSearchParams] = useSearchParams();
const activeTab = searchParams.get('tab') || 'overview';

const handleTabChange = (value: string) => {
  setSearchParams({ tab: value }, { replace: true });
};
```

**Step 3: Wrap the content in Tabs**

Replace the return statement's content structure. Move the existing Card components into TabsContent for the "bracket" tab. The new structure:

```tsx
return (
  <div className="space-y-6">
    {/* Tournament Header - always visible */}
    <div className="flex justify-between items-center">
      <div>
        <h1 className="text-2xl font-bold">{tournament.fplLeagueName}</h1>
        <p className="text-sm text-muted-foreground">
          {currentRound?.name || `Round ${tournament.currentRound}`} â€¢ GW{tournament.currentGameweek}
        </p>
      </div>
      <div className="flex items-center gap-2">
        {isRefreshing && (
          <div className="flex items-center gap-1.5 text-sm text-muted-foreground">
            <Spinner className="size-3" />
            <span>Updating...</span>
          </div>
        )}
        <Badge variant={tournament.status === 'completed' ? 'secondary' : 'default'}>
          {tournament.status === 'completed' ? 'Completed' : 'Active'}
        </Badge>
        <Button
          variant="ghost"
          size="icon"
          onClick={() => setShowShareDialog(true)}
          aria-label="Share tournament"
        >
          <Share2 className="h-4 w-4" />
        </Button>
      </div>
    </div>

    {/* Tabs */}
    <Tabs value={activeTab} onValueChange={handleTabChange}>
      <TabsList className="grid w-full grid-cols-4">
        <TabsTrigger value="overview">Overview</TabsTrigger>
        <TabsTrigger value="matches">Matches</TabsTrigger>
        <TabsTrigger value="participants">Participants</TabsTrigger>
        <TabsTrigger value="bracket">Bracket</TabsTrigger>
      </TabsList>

      <TabsContent value="overview" className="mt-6">
        <Card>
          <CardContent className="py-8 text-center">
            <p className="text-muted-foreground">Overview tab coming soon...</p>
          </CardContent>
        </Card>
      </TabsContent>

      <TabsContent value="matches" className="mt-6">
        <Card>
          <CardContent className="py-8 text-center">
            <p className="text-muted-foreground">Matches tab coming soon...</p>
          </CardContent>
        </Card>
      </TabsContent>

      <TabsContent value="participants" className="mt-6">
        {tournament.rounds.length > 0 && (
          <Card>
            <CardContent className="pt-6">
              <ParticipantsTable
                participants={tournament.participants}
                seedingGameweek={tournament.startGameweek - 1}
              />
            </CardContent>
          </Card>
        )}
      </TabsContent>

      <TabsContent value="bracket" className="mt-6">
        {/* Your Matches Section - for authenticated users who are participants */}
        {isAuthenticated && userIsParticipant && tournament.rounds.length > 0 && (
          <Card className="mb-6">
            <CardContent className="pt-6">
              {userParticipant && (
                <div className="flex items-center gap-2 mb-4">
                  <span className="text-sm text-muted-foreground">Playing as</span>
                  <span className="font-medium">{userParticipant.fplTeamName}</span>
                </div>
              )}
              <YourMatchesSection
                matches={userMatches}
                currentGameweek={tournament.currentGameweek}
                isLive={hasLiveUserMatch}
              />
            </CardContent>
          </Card>
        )}

        {/* Unauthenticated user flow - Team Search */}
        {!isAuthenticated && tournament.rounds.length > 0 && (
          <>
            {overlayMounted && (
              <div
                className={`transition-opacity duration-200 mb-6 ${
                  overlayVisible ? 'opacity-100' : 'opacity-0'
                }`}
              >
                <TeamSearchOverlay
                  participants={tournament.participants}
                  onConfirm={handleTeamConfirm}
                  onClose={handleSearchClose}
                />
              </div>
            )}

            {previewedTeamId && !showSearch && (
              <Card className="mb-6">
                <CardContent className="pt-6">
                  {previewedParticipant && (
                    <div className="flex items-center justify-between mb-4">
                      <div className="flex items-center gap-2">
                        <span className="text-sm text-muted-foreground">
                          Viewing as
                        </span>
                        <span className="font-medium">
                          {previewedParticipant.fplTeamName}
                        </span>
                      </div>
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={handleChangeTeam}
                      >
                        Change team
                      </Button>
                    </div>
                  )}
                  <YourMatchesSection
                    matches={previewedMatches}
                    currentGameweek={tournament.currentGameweek}
                    isLive={hasLivePreviewMatch}
                  />
                </CardContent>

                {onClaimTeam && (
                  <div
                    className={`border-t bg-muted/30 px-6 py-4 transition-all duration-300 ease-out ${
                      ctaVisible
                        ? 'opacity-100 translate-y-0'
                        : 'opacity-0 translate-y-4'
                    }`}
                  >
                    <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
                      <p className="text-sm text-muted-foreground text-center sm:text-left">
                        Sign up to get notified when results are in
                      </p>
                      <Button onClick={handleSignupClick}>
                        Sign up and claim team
                      </Button>
                    </div>
                  </div>
                )}
              </Card>
            )}

            {!previewedTeamId && !showSearch && (
              <Card className="mb-6">
                <CardContent className="py-8 text-center">
                  <p className="text-muted-foreground mb-4">
                    Select your team to see your matches
                  </p>
                  <Button variant="outline" onClick={handleChangeTeam}>
                    Find your team
                  </Button>
                </CardContent>
              </Card>
            )}
          </>
        )}

        {/* Bracket visualization */}
        <Card>
          <CardContent className="pt-6">
            {tournament.rounds.length > 0 ? (
              tournament.participants.length > 64 ? (
                <UserPathBracket
                  tournament={tournament}
                  userFplTeamId={userFplTeamId}
                  isAuthenticated={isAuthenticated}
                  currentGameweek={tournament.currentGameweek}
                />
              ) : (
                <BracketLayout
                  rounds={tournament.rounds}
                  participants={tournament.participants}
                  currentGameweek={tournament.currentGameweek}
                  isAuthenticated={isAuthenticated}
                  onClaimTeam={onClaimTeam}
                />
              )
            ) : (
              <p className="text-muted-foreground text-center py-8">
                Bracket will appear when the tournament starts.
              </p>
            )}
          </CardContent>
        </Card>
      </TabsContent>
    </Tabs>

    {/* Share Tournament Dialog */}
    <ShareTournamentDialog
      isOpen={showShareDialog}
      onClose={() => setShowShareDialog(false)}
      leagueId={tournament.fplLeagueId}
      leagueName={tournament.fplLeagueName}
      roundName={currentRound?.name}
      participantCount={tournament.participants.length}
    />
  </div>
);
```

**Step 4: Verify application runs**

Run: `npm run dev`
Navigate to a tournament page, verify:
- [ ] Tabs display correctly
- [ ] URL updates when switching tabs (`?tab=overview`, `?tab=bracket`, etc.)
- [ ] Bracket tab shows the existing bracket content
- [ ] Participants tab shows the participants table

**Step 5: Commit**

```bash
git add src/components/tournament/TournamentView.tsx
git commit -m "$(cat <<'EOF'
feat: add tabbed navigation to TournamentView

- Add Tabs wrapper with Overview, Matches, Participants, Bracket tabs
- Sync tab state with URL query param (?tab=overview)
- Move existing bracket content to Bracket tab
- Move ParticipantsTable to Participants tab
- Add placeholder content for Overview and Matches tabs

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"
```

---

## Task 5: Create TournamentStats Component

**Files:**
- Create: `src/components/tournament/TournamentStats.tsx`
- Test: `src/components/tournament/TournamentStats.test.tsx`

**Step 1: Write the failing test**

Create `src/components/tournament/TournamentStats.test.tsx`:

```typescript
import { render, screen } from '@testing-library/react';
import { describe, it, expect } from 'vitest';
import { TournamentStats } from './TournamentStats';

describe('TournamentStats', () => {
  const defaultProps = {
    totalParticipants: 48204,
    remainingParticipants: 3012,
    currentRound: 5,
    totalRounds: 8,
    currentRoundName: 'Quarter-Finals',
    currentGameweek: 28,
  };

  it('renders teams remaining with progress bar', () => {
    render(<TournamentStats {...defaultProps} />);

    expect(screen.getByText('Teams Remaining')).toBeInTheDocument();
    expect(screen.getByText('3,012 / 48,204')).toBeInTheDocument();
    // Progress bar should exist
    expect(screen.getByRole('progressbar')).toBeInTheDocument();
  });

  it('renders current round info', () => {
    render(<TournamentStats {...defaultProps} />);

    expect(screen.getByText('Current Round')).toBeInTheDocument();
    expect(screen.getByText(/Quarter-Finals/)).toBeInTheDocument();
    expect(screen.getByText(/GW28/)).toBeInTheDocument();
    expect(screen.getByText('3 rounds remaining')).toBeInTheDocument();
  });

  it('renders user status when provided', () => {
    render(<TournamentStats {...defaultProps} userSeed={142} userStatus="in" />);

    expect(screen.getByText('Your Status')).toBeInTheDocument();
    expect(screen.getByText('#142')).toBeInTheDocument();
    expect(screen.getByText('Active')).toBeInTheDocument();
  });

  it('renders eliminated status correctly', () => {
    render(
      <TournamentStats
        {...defaultProps}
        userSeed={142}
        userStatus="eliminated"
        eliminatedRound={3}
      />
    );

    expect(screen.getByText('Eliminated R3')).toBeInTheDocument();
  });

  it('does not render user status when userStatus is null', () => {
    render(<TournamentStats {...defaultProps} userStatus={null} />);

    expect(screen.queryByText('Your Status')).not.toBeInTheDocument();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test -- src/components/tournament/TournamentStats.test.tsx`
Expected: FAIL - Cannot find module './TournamentStats'

**Step 3: Write minimal implementation**

Create `src/components/tournament/TournamentStats.tsx`:

```typescript
import { Card, CardContent, CardHeader, CardTitle } from '../ui/card';
import { Progress } from '../ui/progress';
import { Badge } from '../ui/badge';
import { BarChart3 } from 'lucide-react';

export interface TournamentStatsProps {
  totalParticipants: number;
  remainingParticipants: number;
  currentRound: number;
  totalRounds: number;
  currentRoundName: string;
  currentGameweek: number;
  userSeed?: number;
  userStatus?: 'in' | 'eliminated' | 'winner' | null;
  eliminatedRound?: number;
}

export function TournamentStats({
  totalParticipants,
  remainingParticipants,
  currentRound,
  totalRounds,
  currentRoundName,
  currentGameweek,
  userSeed,
  userStatus,
  eliminatedRound,
}: TournamentStatsProps) {
  const progressPercent = Math.round(
    (remainingParticipants / totalParticipants) * 100
  );
  const roundsRemaining = totalRounds - currentRound;

  const formatNumber = (n: number) => n.toLocaleString();

  const renderUserStatus = () => {
    if (userStatus === 'in') {
      return (
        <Badge variant="default" className="gap-1">
          <span className="w-2 h-2 rounded-full bg-primary-foreground" />
          Active
        </Badge>
      );
    }
    if (userStatus === 'eliminated') {
      return (
        <Badge variant="destructive">
          Eliminated R{eliminatedRound}
        </Badge>
      );
    }
    if (userStatus === 'winner') {
      return (
        <Badge className="bg-amber-500 hover:bg-amber-600 text-black">
          Champion
        </Badge>
      );
    }
    return null;
  };

  return (
    <Card>
      <CardHeader className="pb-2">
        <CardTitle className="flex items-center gap-2 text-base">
          <BarChart3 className="h-4 w-4" />
          Tournament Stats
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* Teams Remaining */}
        <div className="space-y-2">
          <div className="flex justify-between text-sm">
            <span className="text-muted-foreground">Teams Remaining</span>
            <span className="font-medium">
              {formatNumber(remainingParticipants)} / {formatNumber(totalParticipants)}
            </span>
          </div>
          <Progress value={progressPercent} aria-label="Teams remaining progress" />
          <p className="text-xs text-muted-foreground text-right">
            {progressPercent}% remaining
          </p>
        </div>

        {/* Current Round */}
        <div className="space-y-1 pt-2 border-t">
          <p className="text-sm text-muted-foreground">Current Round</p>
          <p className="font-medium">
            {currentRoundName} â€¢ GW{currentGameweek}
          </p>
          <p className="text-xs text-muted-foreground">
            {roundsRemaining} round{roundsRemaining !== 1 ? 's' : ''} remaining
          </p>
        </div>

        {/* User Status */}
        {userStatus && (
          <div className="pt-2 border-t">
            <p className="text-sm text-muted-foreground mb-2">Your Status</p>
            <div className="grid grid-cols-2 gap-2">
              {userSeed && (
                <div className="bg-muted/50 rounded-md p-2 text-center">
                  <p className="text-xs text-muted-foreground">Seed</p>
                  <p className="font-bold">#{userSeed}</p>
                </div>
              )}
              <div className="bg-muted/50 rounded-md p-2 text-center flex items-center justify-center">
                {renderUserStatus()}
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}
```

**Step 4: Run test to verify it passes**

Run: `npm test -- src/components/tournament/TournamentStats.test.tsx`
Expected: PASS (all 5 tests)

**Step 5: Commit**

```bash
git add src/components/tournament/TournamentStats.tsx src/components/tournament/TournamentStats.test.tsx
git commit -m "$(cat <<'EOF'
feat: add TournamentStats component

Displays tournament progress including:
- Teams remaining with progress bar
- Current round name and gameweek
- Rounds remaining
- User's seed and status (active/eliminated/winner)

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"
```

---

## Task 6: Create YourMatchupCard Component

**Files:**
- Create: `src/components/tournament/YourMatchupCard.tsx`
- Test: `src/components/tournament/YourMatchupCard.test.tsx`

**Step 1: Write the failing test**

Create `src/components/tournament/YourMatchupCard.test.tsx`:

```typescript
import { render, screen } from '@testing-library/react';
import { describe, it, expect } from 'vitest';
import { YourMatchupCard } from './YourMatchupCard';
import type { MatchSummaryCardProps } from '../dashboard/MatchSummaryCard';

describe('YourMatchupCard', () => {
  const liveMatch: MatchSummaryCardProps = {
    type: 'live',
    yourTeamName: 'O-win FC',
    opponentTeamName: 'Klopps & Robbers',
    yourFplTeamId: 158256,
    opponentFplTeamId: 12345,
    leagueName: 'Premier League Fans',
    roundName: 'Round 5',
    yourScore: 72,
    theirScore: 65,
    gameweek: 24,
  };

  it('renders your team on top with YOU label', () => {
    render(
      <YourMatchupCard
        match={liveMatch}
        yourSeed={142}
        opponentSeed={4005}
        tournamentName="Premier League Fans"
      />
    );

    expect(screen.getByText('YOU')).toBeInTheDocument();
    expect(screen.getByText(/Seed #142/)).toBeInTheDocument();
    expect(screen.getByText('O-win FC')).toBeInTheDocument();
  });

  it('renders opponent below with OPPONENT label', () => {
    render(
      <YourMatchupCard
        match={liveMatch}
        yourSeed={142}
        opponentSeed={4005}
        tournamentName="Premier League Fans"
      />
    );

    expect(screen.getByText('OPPONENT')).toBeInTheDocument();
    expect(screen.getByText(/Seed #4005/)).toBeInTheDocument();
    expect(screen.getByText('Klopps & Robbers')).toBeInTheDocument();
  });

  it('renders scores for live match', () => {
    render(
      <YourMatchupCard
        match={liveMatch}
        yourSeed={142}
        opponentSeed={4005}
        tournamentName="Premier League Fans"
      />
    );

    expect(screen.getByText('72 pts')).toBeInTheDocument();
    expect(screen.getByText('65 pts')).toBeInTheDocument();
  });

  it('renders Live badge for live match', () => {
    render(
      <YourMatchupCard
        match={liveMatch}
        yourSeed={142}
        opponentSeed={4005}
        tournamentName="Premier League Fans"
      />
    );

    expect(screen.getByText('Live')).toBeInTheDocument();
    expect(screen.getByText(/GW24/)).toBeInTheDocument();
  });

  it('renders VS for upcoming match', () => {
    const upcomingMatch: MatchSummaryCardProps = {
      ...liveMatch,
      type: 'upcoming',
      yourScore: null,
      theirScore: null,
    };

    render(
      <YourMatchupCard
        match={upcomingMatch}
        yourSeed={142}
        opponentSeed={4005}
        tournamentName="Premier League Fans"
      />
    );

    expect(screen.getByText('VS')).toBeInTheDocument();
    expect(screen.getByText('Upcoming')).toBeInTheDocument();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test -- src/components/tournament/YourMatchupCard.test.tsx`
Expected: FAIL - Cannot find module './YourMatchupCard'

**Step 3: Write minimal implementation**

Create `src/components/tournament/YourMatchupCard.tsx`:

```typescript
import { Card, CardContent, CardHeader, CardFooter } from '../ui/card';
import { Badge } from '../ui/badge';
import { Button } from '../ui/button';
import { cn } from '@/lib/utils';
import { getInitials } from '@/lib/initials';
import type { MatchSummaryCardProps } from '../dashboard/MatchSummaryCard';

export interface YourMatchupCardProps {
  match: MatchSummaryCardProps;
  yourSeed: number;
  opponentSeed?: number;
  tournamentName: string;
  onViewDetails?: () => void;
  onAnalyzeOpponent?: () => void;
}

interface TeamRowProps {
  label: 'YOU' | 'OPPONENT';
  teamName?: string;
  seed?: number;
  score?: number | null;
  isWinning?: boolean;
  isLoser?: boolean;
  isTBD?: boolean;
}

function TeamRow({
  label,
  teamName,
  seed,
  score,
  isWinning,
  isLoser,
  isTBD,
}: TeamRowProps) {
  const initials = isTBD ? 'TBD' : teamName ? getInitials(teamName) : '??';
  const isYou = label === 'YOU';

  return (
    <div className={cn('space-y-2', isLoser && 'opacity-60')}>
      <div className="flex items-center gap-2">
        <span
          className={cn(
            'text-xs font-bold',
            isYou ? 'text-primary' : 'text-muted-foreground'
          )}
        >
          {label}
        </span>
        {seed && (
          <span className="text-xs text-muted-foreground">(Seed #{seed})</span>
        )}
      </div>
      <div
        className={cn(
          'flex items-center justify-between p-3 rounded-lg border',
          isYou && !isLoser && 'border-primary/30 bg-primary/5',
          !isYou && !isLoser && 'border-muted bg-muted/30',
          isLoser && 'border-muted bg-muted/10'
        )}
      >
        <div className="flex items-center gap-3">
          {/* Avatar */}
          <div
            className={cn(
              'h-10 w-10 rounded-full flex items-center justify-center font-bold text-sm',
              isTBD && 'border-2 border-dashed border-muted-foreground/50 text-muted-foreground text-xs',
              isYou && !isTBD && 'border-2 border-primary bg-primary/10 text-primary',
              !isYou && !isTBD && 'border border-muted bg-muted/50 text-muted-foreground'
            )}
          >
            {initials}
          </div>
          {/* Team Name */}
          <span className={cn('font-medium', isTBD && 'text-muted-foreground')}>
            {isTBD ? 'TBD' : teamName}
          </span>
        </div>
        {/* Score */}
        {score != null && (
          <span
            className={cn(
              'font-bold text-lg tabular-nums',
              isWinning && 'text-primary'
            )}
          >
            {score} pts
          </span>
        )}
      </div>
    </div>
  );
}

export function YourMatchupCard({
  match,
  yourSeed,
  opponentSeed,
  tournamentName,
  onViewDetails,
  onAnalyzeOpponent,
}: YourMatchupCardProps) {
  const { type, yourScore, theirScore, roundName, gameweek, result, opponentTeamName } = match;
  const isTBD = !opponentTeamName;
  const hasScores = yourScore != null && theirScore != null;
  const youWinning = hasScores && yourScore > theirScore;
  const theyWinning = hasScores && theirScore > yourScore;
  const youWon = type === 'finished' && result === 'won';
  const youLost = type === 'finished' && result === 'lost';

  const renderStatusBadge = () => {
    switch (type) {
      case 'live':
        return (
          <Badge variant="default" className="gap-1.5">
            <span className="w-2 h-2 rounded-full bg-primary-foreground animate-pulse" />
            Live
          </Badge>
        );
      case 'finished':
        return (
          <Badge variant={youWon ? 'default' : 'destructive'}>
            {youWon ? 'Won' : 'Lost'}
          </Badge>
        );
      case 'upcoming':
        return <Badge variant="outline">Upcoming</Badge>;
    }
  };

  const cardClasses = cn('overflow-hidden', {
    'border-2 border-primary shadow-[0_0_20px_rgba(0,255,136,0.2)]': type === 'live',
    'border border-primary/30': type === 'finished' && youWon,
    'border border-muted': type === 'finished' && youLost,
    'border-2 border-dashed border-muted': type === 'upcoming',
  });

  return (
    <Card className={cardClasses}>
      <CardHeader className="flex flex-row items-center justify-between pb-2">
        <div className="flex items-center gap-2">
          {renderStatusBadge()}
          <span className="text-sm text-muted-foreground">
            {roundName}
          </span>
        </div>
        <span className="text-sm text-muted-foreground">
          GW{gameweek}
        </span>
      </CardHeader>

      <CardContent className="space-y-4">
        {/* Your Team - Top */}
        <TeamRow
          label="YOU"
          teamName={match.yourTeamName}
          seed={yourSeed}
          score={yourScore}
          isWinning={youWinning || youWon}
          isLoser={youLost}
        />

        {/* VS Separator */}
        <div className="flex items-center justify-center py-2">
          {type === 'upcoming' ? (
            <span className="text-2xl font-bold text-muted-foreground">VS</span>
          ) : (
            <div className="flex items-center gap-2 text-muted-foreground">
              <div className="h-px w-8 bg-muted" />
              <span className="text-xs">VS</span>
              <div className="h-px w-8 bg-muted" />
            </div>
          )}
        </div>

        {/* Opponent - Bottom */}
        <TeamRow
          label="OPPONENT"
          teamName={opponentTeamName}
          seed={opponentSeed}
          score={theirScore}
          isWinning={theyWinning || youLost}
          isLoser={youWon}
          isTBD={isTBD}
        />
      </CardContent>

      {(onViewDetails || onAnalyzeOpponent) && (
        <CardFooter className="flex justify-between gap-2 border-t bg-muted/30 px-4 py-3">
          {onViewDetails && (
            <Button variant="ghost" size="sm" onClick={onViewDetails}>
              View Match Details
            </Button>
          )}
          {onAnalyzeOpponent && !isTBD && (
            <Button variant="ghost" size="sm" onClick={onAnalyzeOpponent}>
              Analyze Opponent
            </Button>
          )}
        </CardFooter>
      )}
    </Card>
  );
}
```

**Step 4: Run test to verify it passes**

Run: `npm test -- src/components/tournament/YourMatchupCard.test.tsx`
Expected: PASS (all 5 tests)

**Step 5: Commit**

```bash
git add src/components/tournament/YourMatchupCard.tsx src/components/tournament/YourMatchupCard.test.tsx
git commit -m "$(cat <<'EOF'
feat: add YourMatchupCard component

Vertical layout hero card showing:
- Your team on top with seed
- VS separator
- Opponent below with seed
- Live/finished/upcoming states
- Action buttons for details and analysis

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"
```

---

## Task 7: Create PossibleOpponents Component

**Files:**
- Create: `src/components/tournament/PossibleOpponents.tsx`
- Test: `src/components/tournament/PossibleOpponents.test.tsx`

**Step 1: Write the failing test**

Create `src/components/tournament/PossibleOpponents.test.tsx`:

```typescript
import { render, screen } from '@testing-library/react';
import { describe, it, expect } from 'vitest';
import { PossibleOpponents } from './PossibleOpponents';
import type { Match } from '@/types/tournament';

describe('PossibleOpponents', () => {
  const siblingMatch: Match = {
    id: 'match-1024',
    players: [
      { fplTeamId: 111, seed: 82, score: 62, teamName: 'KDB De Bruyne' },
      { fplTeamId: 222, seed: 156, score: 41, teamName: 'No Kane No Gain' },
    ],
    winnerId: null,
    isBye: false,
  };

  it('renders section header', () => {
    render(
      <PossibleOpponents
        match={siblingMatch}
        nextGameweek={29}
        currentGameweek={28}
      />
    );

    expect(screen.getByText('Possible Next Opponents')).toBeInTheDocument();
  });

  it('renders both potential opponents', () => {
    render(
      <PossibleOpponents
        match={siblingMatch}
        nextGameweek={29}
        currentGameweek={28}
      />
    );

    expect(screen.getByText('KDB De Bruyne')).toBeInTheDocument();
    expect(screen.getByText('No Kane No Gain')).toBeInTheDocument();
  });

  it('renders scores when match is live', () => {
    render(
      <PossibleOpponents
        match={siblingMatch}
        nextGameweek={29}
        currentGameweek={28}
      />
    );

    expect(screen.getByText('62')).toBeInTheDocument();
    expect(screen.getByText('41')).toBeInTheDocument();
  });

  it('renders footer message with next gameweek', () => {
    render(
      <PossibleOpponents
        match={siblingMatch}
        nextGameweek={29}
        currentGameweek={28}
      />
    );

    expect(
      screen.getByText(/If you win, you'll face the winner in GW29/)
    ).toBeInTheDocument();
  });

  it('renders Live badge when match is current gameweek', () => {
    render(
      <PossibleOpponents
        match={siblingMatch}
        nextGameweek={29}
        currentGameweek={28}
      />
    );

    expect(screen.getByText('Live')).toBeInTheDocument();
    expect(screen.getByText('GW28')).toBeInTheDocument();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test -- src/components/tournament/PossibleOpponents.test.tsx`
Expected: FAIL - Cannot find module './PossibleOpponents'

**Step 3: Write minimal implementation**

Create `src/components/tournament/PossibleOpponents.tsx`:

```typescript
import { Card, CardContent, CardHeader, CardTitle, CardFooter } from '../ui/card';
import { Badge } from '../ui/badge';
import { Eye, Info } from 'lucide-react';
import { cn } from '@/lib/utils';
import { getMatchPlayers } from '@/types/tournament';
import type { Match } from '@/types/tournament';

export interface PossibleOpponentsProps {
  match: Match;
  nextGameweek: number;
  currentGameweek: number;
}

export function PossibleOpponents({
  match,
  nextGameweek,
  currentGameweek,
}: PossibleOpponentsProps) {
  const players = getMatchPlayers(match);
  const isLive = players.some((p) => p.score !== null);
  const matchGameweek = currentGameweek; // Sibling match is same GW as user's match

  // Determine which player is winning
  const [player1, player2] = players;
  const hasScores = player1?.score != null && player2?.score != null;
  const player1Winning = hasScores && (player1?.score ?? 0) > (player2?.score ?? 0);
  const player2Winning = hasScores && (player2?.score ?? 0) > (player1?.score ?? 0);

  return (
    <Card>
      <CardHeader className="pb-2">
        <CardTitle className="flex items-center gap-2 text-base">
          <Eye className="h-4 w-4" />
          Possible Next Opponents
        </CardTitle>
        <p className="text-xs text-muted-foreground">
          Winner of Match #{match.id.slice(-4)}
        </p>
      </CardHeader>

      <CardContent>
        <div
          className={cn(
            'rounded-lg border p-3 space-y-2',
            isLive && 'border-primary/30 bg-primary/5'
          )}
        >
          {/* Match Header */}
          <div className="flex items-center justify-between">
            {isLive ? (
              <Badge variant="default" className="gap-1.5">
                <span className="w-2 h-2 rounded-full bg-primary-foreground animate-pulse" />
                Live
              </Badge>
            ) : (
              <Badge variant="outline">Upcoming</Badge>
            )}
            <span className="text-xs text-muted-foreground">GW{matchGameweek}</span>
          </div>

          {/* Players */}
          <div className="space-y-1">
            {player1 && (
              <div
                className={cn(
                  'flex items-center justify-between py-1',
                  player1Winning && 'font-medium'
                )}
              >
                <span className={cn(player2Winning && 'text-muted-foreground')}>
                  {player1.teamName}
                </span>
                {player1.score != null && (
                  <span
                    className={cn(
                      'tabular-nums',
                      player1Winning && 'text-primary font-bold',
                      player2Winning && 'text-muted-foreground'
                    )}
                  >
                    {player1.score}
                  </span>
                )}
              </div>
            )}

            <div className="h-px bg-muted" />

            {player2 && (
              <div
                className={cn(
                  'flex items-center justify-between py-1',
                  player2Winning && 'font-medium'
                )}
              >
                <span className={cn(player1Winning && 'text-muted-foreground')}>
                  {player2.teamName}
                </span>
                {player2.score != null && (
                  <span
                    className={cn(
                      'tabular-nums',
                      player2Winning && 'text-primary font-bold',
                      player1Winning && 'text-muted-foreground'
                    )}
                  >
                    {player2.score}
                  </span>
                )}
              </div>
            )}
          </div>
        </div>
      </CardContent>

      <CardFooter className="pt-0">
        <p className="text-xs text-muted-foreground flex items-center gap-1">
          <Info className="h-3 w-3" />
          If you win, you'll face the winner in GW{nextGameweek}
        </p>
      </CardFooter>
    </Card>
  );
}
```

**Step 4: Run test to verify it passes**

Run: `npm test -- src/components/tournament/PossibleOpponents.test.tsx`
Expected: PASS (all 5 tests)

**Step 5: Commit**

```bash
git add src/components/tournament/PossibleOpponents.tsx src/components/tournament/PossibleOpponents.test.tsx
git commit -m "$(cat <<'EOF'
feat: add PossibleOpponents component

Shows the sibling match that determines next opponent:
- Match card with both potential opponents
- Live/upcoming badge with gameweek
- Scores when match is live
- Footer explaining next round timing

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"
```

---

## Task 8: Create findNextOpponentMatch Helper

**Files:**
- Modify: `src/types/tournament.ts`
- Test: `src/types/tournament.test.ts` (create if not exists)

**Step 1: Write the failing test**

Create or update `src/types/tournament.test.ts`:

```typescript
import { describe, it, expect } from 'vitest';
import { findNextOpponentMatch, getMatchPlayers } from './tournament';
import type { Tournament, Match, Round } from './tournament';

describe('findNextOpponentMatch', () => {
  const createMockTournament = (): Tournament => ({
    id: 'test-tournament',
    fplLeagueId: 123,
    fplLeagueName: 'Test League',
    creatorUserId: 'user-1',
    startGameweek: 20,
    currentRound: 2,
    currentGameweek: 21,
    totalRounds: 3,
    status: 'active',
    participants: [],
    rounds: [
      {
        roundNumber: 1,
        name: 'Round 1',
        gameweek: 20,
        isComplete: true,
        matches: [
          { id: 'r1-m1', winnerId: 1, isBye: false, qualifiesTo: 'r2-m1', players: [] },
          { id: 'r1-m2', winnerId: 2, isBye: false, qualifiesTo: 'r2-m1', players: [] },
          { id: 'r1-m3', winnerId: 3, isBye: false, qualifiesTo: 'r2-m2', players: [] },
          { id: 'r1-m4', winnerId: 4, isBye: false, qualifiesTo: 'r2-m2', players: [] },
        ],
      },
      {
        roundNumber: 2,
        name: 'Semi-Finals',
        gameweek: 21,
        isComplete: false,
        matches: [
          {
            id: 'r2-m1',
            winnerId: null,
            isBye: false,
            qualifiesTo: 'r3-m1',
            players: [
              { fplTeamId: 1, seed: 1, score: 70, teamName: 'Team 1' },
              { fplTeamId: 2, seed: 2, score: 65, teamName: 'Team 2' },
            ],
          },
          {
            id: 'r2-m2',
            winnerId: null,
            isBye: false,
            qualifiesTo: 'r3-m1',
            players: [
              { fplTeamId: 3, seed: 3, score: 80, teamName: 'Team 3' },
              { fplTeamId: 4, seed: 4, score: 75, teamName: 'Team 4' },
            ],
          },
        ],
      },
      {
        roundNumber: 3,
        name: 'Final',
        gameweek: 22,
        isComplete: false,
        matches: [
          { id: 'r3-m1', winnerId: null, isBye: false, players: [] },
        ],
      },
    ],
    winnerId: null,
    createdAt: '2025-01-01',
    updatedAt: '2025-01-01',
  });

  it('finds sibling match with same qualifiesTo', () => {
    const tournament = createMockTournament();
    const userMatch = tournament.rounds[1].matches[0]; // r2-m1

    const siblingMatch = findNextOpponentMatch(tournament, userMatch);

    expect(siblingMatch).not.toBeNull();
    expect(siblingMatch?.id).toBe('r2-m2');
  });

  it('returns null when user is in final (no qualifiesTo)', () => {
    const tournament = createMockTournament();
    const finalMatch = tournament.rounds[2].matches[0]; // r3-m1

    const siblingMatch = findNextOpponentMatch(tournament, finalMatch);

    expect(siblingMatch).toBeNull();
  });

  it('returns null when no sibling match exists', () => {
    const tournament = createMockTournament();
    // Modify to have only one match qualifying to final
    tournament.rounds[1].matches = [tournament.rounds[1].matches[0]];
    const userMatch = tournament.rounds[1].matches[0];

    const siblingMatch = findNextOpponentMatch(tournament, userMatch);

    expect(siblingMatch).toBeNull();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test -- src/types/tournament.test.ts`
Expected: FAIL - findNextOpponentMatch is not exported

**Step 3: Write minimal implementation**

Add to `src/types/tournament.ts` (at the end of the file):

```typescript
/**
 * Find the sibling match that determines who the user will face next.
 * Returns null if user is in the final or no sibling match exists.
 */
export function findNextOpponentMatch(
  tournament: Tournament,
  userCurrentMatch: Match
): Match | null {
  const targetMatchId = userCurrentMatch.qualifiesTo;
  if (!targetMatchId) return null; // User is in final

  // Find other match that also qualifies to same target
  for (const round of tournament.rounds) {
    for (const match of round.matches) {
      if (
        match.qualifiesTo === targetMatchId &&
        match.id !== userCurrentMatch.id
      ) {
        return match;
      }
    }
  }
  return null;
}
```

**Step 4: Run test to verify it passes**

Run: `npm test -- src/types/tournament.test.ts`
Expected: PASS (all 3 tests)

**Step 5: Commit**

```bash
git add src/types/tournament.ts src/types/tournament.test.ts
git commit -m "$(cat <<'EOF'
feat: add findNextOpponentMatch helper function

Finds the sibling match that determines the user's potential
next opponent. Uses qualifiesTo field to locate matches that
feed into the same next-round match.

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"
```

---

## Task 9: Create OverviewTab Component

**Files:**
- Create: `src/components/tournament/OverviewTab.tsx`
- Test: `src/components/tournament/OverviewTab.test.tsx`

**Step 1: Write the failing test**

Create `src/components/tournament/OverviewTab.test.tsx`:

```typescript
import { render, screen } from '@testing-library/react';
import { describe, it, expect, vi } from 'vitest';
import { OverviewTab } from './OverviewTab';
import type { Tournament, Participant } from '@/types/tournament';
import type { MatchSummaryCardProps } from '../dashboard/MatchSummaryCard';

// Mock the child components to simplify testing
vi.mock('./YourMatchupCard', () => ({
  YourMatchupCard: ({ match }: { match: MatchSummaryCardProps }) => (
    <div data-testid="your-matchup-card">{match.yourTeamName}</div>
  ),
}));

vi.mock('./TournamentStats', () => ({
  TournamentStats: () => <div data-testid="tournament-stats">Stats</div>,
}));

vi.mock('./PossibleOpponents', () => ({
  PossibleOpponents: () => <div data-testid="possible-opponents">Opponents</div>,
}));

vi.mock('../dashboard/YourMatchesSection', () => ({
  YourMatchesSection: ({ matches }: { matches: MatchSummaryCardProps[] }) => (
    <div data-testid="match-history">{matches.length} matches</div>
  ),
}));

describe('OverviewTab', () => {
  const mockParticipant: Participant = {
    fplTeamId: 158256,
    fplTeamName: 'O-win FC',
    managerName: 'Owen',
    seed: 142,
  };

  const mockTournament: Tournament = {
    id: 'test',
    fplLeagueId: 123,
    fplLeagueName: 'Test League',
    creatorUserId: 'user-1',
    startGameweek: 20,
    currentRound: 2,
    currentGameweek: 21,
    totalRounds: 5,
    status: 'active',
    participants: [mockParticipant],
    rounds: [],
    winnerId: null,
    createdAt: '2025-01-01',
    updatedAt: '2025-01-01',
  };

  const mockMatches: MatchSummaryCardProps[] = [
    {
      type: 'live',
      yourTeamName: 'O-win FC',
      opponentTeamName: 'Opponent FC',
      yourFplTeamId: 158256,
      opponentFplTeamId: 12345,
      leagueName: 'Test League',
      roundName: 'Round 2',
      yourScore: 72,
      theirScore: 65,
      gameweek: 21,
    },
  ];

  it('renders TournamentStats always', () => {
    render(
      <OverviewTab
        tournament={mockTournament}
        userFplTeamId={null}
        isAuthenticated={false}
        matches={[]}
      />
    );

    expect(screen.getByTestId('tournament-stats')).toBeInTheDocument();
  });

  it('renders YourMatchupCard when user has current match', () => {
    render(
      <OverviewTab
        tournament={mockTournament}
        userFplTeamId={158256}
        isAuthenticated={true}
        matches={mockMatches}
        currentMatch={mockMatches[0]}
        userParticipant={mockParticipant}
      />
    );

    expect(screen.getByTestId('your-matchup-card')).toBeInTheDocument();
  });

  it('does not render YourMatchupCard when no current match', () => {
    render(
      <OverviewTab
        tournament={mockTournament}
        userFplTeamId={158256}
        isAuthenticated={true}
        matches={[]}
        userParticipant={mockParticipant}
      />
    );

    expect(screen.queryByTestId('your-matchup-card')).not.toBeInTheDocument();
  });

  it('renders match history when user has completed matches', () => {
    const completedMatch: MatchSummaryCardProps = {
      ...mockMatches[0],
      type: 'finished',
      result: 'won',
    };

    render(
      <OverviewTab
        tournament={mockTournament}
        userFplTeamId={158256}
        isAuthenticated={true}
        matches={[completedMatch]}
        userParticipant={mockParticipant}
      />
    );

    expect(screen.getByTestId('match-history')).toBeInTheDocument();
    expect(screen.getByText('1 matches')).toBeInTheDocument();
  });
});
```

**Step 2: Run test to verify it fails**

Run: `npm test -- src/components/tournament/OverviewTab.test.tsx`
Expected: FAIL - Cannot find module './OverviewTab'

**Step 3: Write minimal implementation**

Create `src/components/tournament/OverviewTab.tsx`:

```typescript
import { useMemo } from 'react';
import { Card, CardContent } from '../ui/card';
import { YourMatchupCard } from './YourMatchupCard';
import { TournamentStats } from './TournamentStats';
import { PossibleOpponents } from './PossibleOpponents';
import { YourMatchesSection } from '../dashboard/YourMatchesSection';
import { findNextOpponentMatch } from '@/types/tournament';
import type { Tournament, Participant, Match } from '@/types/tournament';
import type { MatchSummaryCardProps } from '../dashboard/MatchSummaryCard';

export interface OverviewTabProps {
  tournament: Tournament;
  userFplTeamId: number | null;
  isAuthenticated: boolean;
  matches: MatchSummaryCardProps[];
  currentMatch?: MatchSummaryCardProps;
  userParticipant?: Participant;
  userCurrentMatchRaw?: Match; // Raw match object for finding sibling
}

export function OverviewTab({
  tournament,
  userFplTeamId,
  isAuthenticated,
  matches,
  currentMatch,
  userParticipant,
  userCurrentMatchRaw,
}: OverviewTabProps) {
  // Calculate remaining participants
  const remainingParticipants = useMemo(() => {
    // Count participants not eliminated
    return tournament.participants.filter((p) => {
      // Check if participant has been eliminated by looking at rounds
      for (const round of tournament.rounds) {
        for (const match of round.matches) {
          if (round.isComplete && match.winnerId) {
            const players = match.players || [];
            const wasInMatch = players.some((pl) => pl.fplTeamId === p.fplTeamId);
            const isWinner = match.winnerId === p.fplTeamId;
            if (wasInMatch && !isWinner) {
              return false; // Eliminated
            }
          }
        }
      }
      return true;
    }).length;
  }, [tournament]);

  // Get current round info
  const currentRound = tournament.rounds.find(
    (r) => r.roundNumber === tournament.currentRound
  );

  // Determine user status
  const userStatus = useMemo((): 'in' | 'eliminated' | 'winner' | null => {
    if (!userParticipant) return null;

    if (tournament.winnerId === userParticipant.fplTeamId) {
      return 'winner';
    }

    // Check if eliminated
    for (const round of tournament.rounds) {
      for (const match of round.matches) {
        if (round.isComplete && match.winnerId) {
          const players = match.players || [];
          const wasInMatch = players.some(
            (pl) => pl.fplTeamId === userParticipant.fplTeamId
          );
          const isWinner = match.winnerId === userParticipant.fplTeamId;
          if (wasInMatch && !isWinner) {
            return 'eliminated';
          }
        }
      }
    }

    return 'in';
  }, [tournament, userParticipant]);

  // Find eliminated round
  const eliminatedRound = useMemo(() => {
    if (userStatus !== 'eliminated' || !userParticipant) return undefined;

    for (const round of tournament.rounds) {
      for (const match of round.matches) {
        if (round.isComplete && match.winnerId) {
          const players = match.players || [];
          const wasInMatch = players.some(
            (pl) => pl.fplTeamId === userParticipant.fplTeamId
          );
          const isWinner = match.winnerId === userParticipant.fplTeamId;
          if (wasInMatch && !isWinner) {
            return round.roundNumber;
          }
        }
      }
    }
    return undefined;
  }, [tournament, userParticipant, userStatus]);

  // Find sibling match for possible opponents
  const siblingMatch = useMemo(() => {
    if (!userCurrentMatchRaw) return null;
    return findNextOpponentMatch(tournament, userCurrentMatchRaw);
  }, [tournament, userCurrentMatchRaw]);

  // Get opponent's seed
  const opponentSeed = useMemo(() => {
    if (!currentMatch || !currentMatch.opponentFplTeamId) return undefined;
    const opponent = tournament.participants.find(
      (p) => p.fplTeamId === currentMatch.opponentFplTeamId
    );
    return opponent?.seed;
  }, [currentMatch, tournament.participants]);

  // Filter for match history (completed matches only)
  const completedMatches = matches.filter((m) => m.type === 'finished');

  // Check if there's a live match
  const hasLiveMatch = matches.some((m) => m.type === 'live');

  return (
    <div className="space-y-6">
      {/* Main Grid: YourMatchup + Stats */}
      <div className="grid gap-6 lg:grid-cols-3">
        {/* YourMatchupCard - 2/3 width on desktop */}
        {currentMatch && userParticipant && (
          <div className="lg:col-span-2">
            <YourMatchupCard
              match={currentMatch}
              yourSeed={userParticipant.seed}
              opponentSeed={opponentSeed}
              tournamentName={tournament.fplLeagueName}
            />
          </div>
        )}

        {/* TournamentStats - 1/3 width on desktop, full width if no match */}
        <div className={!currentMatch ? 'lg:col-span-3' : ''}>
          <TournamentStats
            totalParticipants={tournament.participants.length}
            remainingParticipants={remainingParticipants}
            currentRound={tournament.currentRound}
            totalRounds={tournament.totalRounds}
            currentRoundName={currentRound?.name || `Round ${tournament.currentRound}`}
            currentGameweek={tournament.currentGameweek}
            userSeed={userParticipant?.seed}
            userStatus={userStatus}
            eliminatedRound={eliminatedRound}
          />
        </div>
      </div>

      {/* Second Row: Friends (placeholder) + PossibleOpponents */}
      <div className="grid gap-6 lg:grid-cols-3">
        {/* Friends Activity - placeholder for Phase 4 */}
        <div className="lg:col-span-2">
          <Card className="border-dashed">
            <CardContent className="py-8 text-center">
              <p className="text-muted-foreground text-sm">
                Friends activity coming soon...
              </p>
            </CardContent>
          </Card>
        </div>

        {/* Possible Opponents - 1/3 width */}
        {siblingMatch && (
          <div>
            <PossibleOpponents
              match={siblingMatch}
              nextGameweek={tournament.currentGameweek + 1}
              currentGameweek={tournament.currentGameweek}
            />
          </div>
        )}
      </div>

      {/* Match History - full width */}
      {completedMatches.length > 0 && (
        <Card>
          <CardContent className="pt-6">
            <YourMatchesSection
              matches={completedMatches}
              currentGameweek={tournament.currentGameweek}
              isLive={hasLiveMatch}
            />
          </CardContent>
        </Card>
      )}

      {/* Empty state when not a participant */}
      {!isAuthenticated && (
        <Card className="border-dashed">
          <CardContent className="py-8 text-center">
            <p className="text-muted-foreground">
              Find your team in the Bracket tab to see your personalized overview.
            </p>
          </CardContent>
        </Card>
      )}
    </div>
  );
}
```

**Step 4: Run test to verify it passes**

Run: `npm test -- src/components/tournament/OverviewTab.test.tsx`
Expected: PASS (all 4 tests)

**Step 5: Commit**

```bash
git add src/components/tournament/OverviewTab.tsx src/components/tournament/OverviewTab.test.tsx
git commit -m "$(cat <<'EOF'
feat: add OverviewTab component

Orchestrates the Overview tab layout with:
- YourMatchupCard (hero, 2/3 width on desktop)
- TournamentStats (sidebar, 1/3 width)
- FriendsActivity placeholder (Phase 4)
- PossibleOpponents card
- Match history using YourMatchesSection

Responsive grid: 2-column on desktop, stacked on mobile.

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"
```

---

## Task 10: Integrate OverviewTab into TournamentView

**Files:**
- Modify: `src/components/tournament/TournamentView.tsx`

**Step 1: Add import for OverviewTab**

At the top of TournamentView.tsx, add:

```typescript
import { OverviewTab } from './OverviewTab';
```

**Step 2: Find user's current match from tournament data**

Inside the component, after `userMatches` calculation, add:

```typescript
// Find user's current/live match for the Overview tab
const userCurrentMatch = useMemo(() => {
  // First look for a live match
  const live = userMatches.find((m) => m.type === 'live');
  if (live) return live;

  // Then look for upcoming
  const upcoming = userMatches.find((m) => m.type === 'upcoming');
  if (upcoming) return upcoming;

  // Fall back to most recent finished
  const finished = [...userMatches]
    .filter((m) => m.type === 'finished')
    .pop();
  return finished;
}, [userMatches]);

// Find the raw Match object for the current match (needed for sibling lookup)
const userCurrentMatchRaw = useMemo(() => {
  if (!userCurrentMatch || !userFplTeamId) return undefined;

  for (const round of tournament.rounds) {
    for (const match of round.matches) {
      const players = match.players || [];
      if (players.some((p) => p.fplTeamId === userFplTeamId)) {
        if (round.gameweek === userCurrentMatch.gameweek) {
          return match;
        }
      }
    }
  }
  return undefined;
}, [tournament, userCurrentMatch, userFplTeamId]);
```

**Step 3: Replace the Overview tab placeholder**

Find the TabsContent for "overview" and replace the placeholder:

```tsx
<TabsContent value="overview" className="mt-6">
  <OverviewTab
    tournament={tournament}
    userFplTeamId={userFplTeamId ?? null}
    isAuthenticated={!!isAuthenticated}
    matches={userIsParticipant ? userMatches : previewedMatches}
    currentMatch={userIsParticipant ? userCurrentMatch : previewedMatches[0]}
    userParticipant={userIsParticipant ? userParticipant : previewedParticipant}
    userCurrentMatchRaw={userCurrentMatchRaw}
  />
</TabsContent>
```

**Step 4: Verify application runs**

Run: `npm run dev`
Navigate to a tournament, verify:
- [ ] Overview tab shows TournamentStats
- [ ] When authenticated as participant, shows YourMatchupCard
- [ ] Match history appears if user has completed matches
- [ ] Possible Opponents card appears (if `qualifiesTo` data is populated)

**Step 5: Run all tests**

Run: `npm test`
Expected: All tests pass

**Step 6: Commit**

```bash
git add src/components/tournament/TournamentView.tsx
git commit -m "$(cat <<'EOF'
feat: integrate OverviewTab into TournamentView

- Wire up OverviewTab with tournament data
- Pass user's current match and participant info
- Include raw match object for sibling match lookup
- Support both authenticated and preview modes

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"
```

---

## Task 11: E2E Verification with Playwright MCP

**Files:**
- No new files (verification only)

**Step 1: Start dev server**

Run: `npm run dev`

**Step 2: Use Playwright MCP to verify**

```typescript
// 1. Navigate to a tournament
await browser_navigate('http://localhost:5173/league/123');
await browser_snapshot();

// 2. Verify tabs are visible
// Look for "Overview", "Matches", "Participants", "Bracket" in snapshot

// 3. Click Overview tab (should be default)
// Verify TournamentStats is visible

// 4. Click Bracket tab
await browser_click({ element: 'Bracket tab', ref: 'TabsTrigger[value="bracket"]' });
await browser_snapshot();
// Verify bracket content is visible

// 5. Check URL has ?tab=bracket
// Verify URL contains ?tab=bracket

// 6. Check console for errors
await browser_console_messages({ onlyErrors: true });
// Verify no errors
```

**Step 3: Manual verification checklist**

- [ ] Tabs display correctly on mobile viewport
- [ ] Tab switching updates URL
- [ ] Refreshing page with `?tab=bracket` goes to bracket
- [ ] Overview tab shows correct user data
- [ ] No console errors

**Step 4: Commit if any fixes needed**

(Only commit if you made changes)

---

## Task 12: Final Cleanup and Documentation

**Files:**
- Update: `docs/plans/tournament-view/2026-01-03-overview-tab-implementation.md`

**Step 1: Mark implementation phases as complete**

Update the implementation phases section:

```markdown
### Phase 1: Tab Structure + Shell
- [x] Add shadcn Tabs component (`npx shadcn@latest add tabs`)
- [x] Rename `BracketView` â†’ `TournamentView`
- [x] Create tab wrapper with URL sync (`?tab=overview`)
- [x] Create placeholder components for all 4 tabs
- [x] Move existing bracket views into `BracketTab`
- [x] Move existing `ParticipantsTable` into `ParticipantsTab`
- [x] Create `MatchesTab` with "Coming soon" placeholder
- [x] Create empty `OverviewTab` shell

### Phase 2: Your Matchup + Match History
- [x] Build `YourMatchupCard` component (vertical layout)
- [x] Integrate existing `YourMatchesSection` for match history
- [x] Wire up data from `buildMatchesForTeam()` (already exists)
- [x] Handle all match states (live/upcoming/finished)

### Phase 3: Tournament Stats + Possible Opponents
- [x] Build `TournamentStats` component
- [x] Build `PossibleOpponents` component
- [x] Add `findNextOpponentMatch()` helper using `qualifiesTo`
- [x] Calculate remaining participants count
```

**Step 2: Commit documentation update**

```bash
git add docs/plans/tournament-view/2026-01-03-overview-tab-implementation.md
git commit -m "$(cat <<'EOF'
docs: mark Overview Tab phases 1-3 as complete

All core Overview tab functionality implemented:
- Tab navigation with URL sync
- YourMatchupCard, TournamentStats, PossibleOpponents
- Match history integration
- findNextOpponentMatch helper

Phase 4 (Friends) remains for future implementation.

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
EOF
)"
```

---

## Summary

This plan implements the Overview Tab feature in 12 tasks:

| Task | Description | Estimated Effort |
|------|-------------|------------------|
| 1 | Add shadcn Tabs | Quick |
| 2 | Add qualifiesTo field | Quick |
| 3 | Rename BracketView â†’ TournamentView | Quick |
| 4 | Add Tabs wrapper | Medium |
| 5 | Create TournamentStats | Medium |
| 6 | Create YourMatchupCard | Medium |
| 7 | Create PossibleOpponents | Medium |
| 8 | Create findNextOpponentMatch | Quick |
| 9 | Create OverviewTab | Medium |
| 10 | Integrate OverviewTab | Quick |
| 11 | E2E Verification | Quick |
| 12 | Documentation cleanup | Quick |

Each task follows TDD with failing test â†’ implementation â†’ passing test â†’ commit.

---

**Plan complete and saved to `docs/plans/2026-01-03-overview-tab-implementation.md`. Two execution options:**

**1. Subagent-Driven (this session)** - I dispatch fresh subagent per task, review between tasks, fast iteration

**2. Parallel Session (separate)** - Open new session with executing-plans, batch execution with checkpoints

**Which approach?**
