import { useState } from 'react';
import { Timestamp } from 'firebase/firestore';
import { Badge } from './ui/badge';
import { Button } from './ui/button';
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from './ui/card';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from './ui/dialog';
import { CountdownTimer } from './CountdownTimer';
import { HeadToHeadPreview } from './HeadToHeadPreview';

interface PreviewStateViewProps {
  gameweek: number;
  deadline: Timestamp;
  creatorFplId: number;
  creatorName: string;
  opponentFplId: number;
  opponentName: string;
  challengeId: string;
}

export function PreviewStateView({
  gameweek,
  deadline,
  creatorFplId,
  creatorName,
  opponentFplId,
  opponentName,
  challengeId,
}: PreviewStateViewProps) {
  const [showTeamsDialog, setShowTeamsDialog] = useState(false);

  const handleShareChallenge = async () => {
    const challengeUrl = `${window.location.origin}/challenge/${challengeId}`;
    try {
      await navigator.clipboard.writeText(challengeUrl);
    } catch (error) {
      console.error('Failed to copy challenge URL:', error);
    }
  };

  const handlePreviewTeams = () => {
    setShowTeamsDialog(true);
  };

  return (
    <Card data-testid="preview-card" className="bg-gradient-to-r from-cyan-400 to-purple-500">
      <CardHeader>
        <CardTitle>⚔️ {creatorName} vs {opponentName}</CardTitle>
        <CardDescription>Gameweek {gameweek} Showdown</CardDescription>
        <Badge>⏰ Starting Soon</Badge>
      </CardHeader>
      <CardContent>
        <div data-testid="preview-state-view">
          <h2>Gameweek {gameweek}</h2>
          <CountdownTimer deadline={deadline.toDate()} />
          <HeadToHeadPreview
            creatorFplId={creatorFplId}
            creatorName={creatorName}
            opponentFplId={opponentFplId}
            opponentName={opponentName}
            gameweek={gameweek}
          />
          <div className="flex gap-2 mt-4">
            <Button variant="outline" onClick={handlePreviewTeams}>Preview Teams</Button>
            <Button variant="outline" onClick={handleShareChallenge}>Share Challenge</Button>
          </div>
        </div>
      </CardContent>
    </Card>

    <Dialog open={showTeamsDialog} onOpenChange={setShowTeamsDialog}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Team Preview</DialogTitle>
        </DialogHeader>
        <div>
          <p>Team lineups will be displayed here for Gameweek {gameweek}</p>
        </div>
      </DialogContent>
    </Dialog>
  </>
  );
}
